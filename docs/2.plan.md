Alright, let's architect this refactor. We're about to rip the guts out of the `DataDemo` page and replace it with a generic, configurable view engine. The goal is to turn a one-off feature into a reusable library primitive that devs can plug their own data into, all without breaking the UI. No jank, just clean abstraction.

We'll take cues from the `dynamic-view` project, focusing on a config-driven approach. Instead of hardcoding `DataItem` properties everywhere, components will render based on a `ViewConfig` object. This makes the views agnostic to the data's shape. The `DataDemo` page itself will become the first "customer" of our new dynamic view library, proving out the concept by recreating itself perfectly.

This is a surgical operation. We'll introduce new abstractions for fields, views, and data, then systematically refactor each component to use them. By the end, the `DataDemo` will look the same, but under the hood, it'll be a completely different beastâ€”a powerful, reusable system ready for any data model you throw at it.

Here's the plan.

```yaml
plan:
  uuid: 'c8a1b4d2-3e5f-4b9a-8c7d-9f1e0g2h3i4j'
  status: 'todo'
  title: 'Refactor DataDemo into a Generic, Config-Driven View Engine'
  introduction: |
    We're decoupling the `DataDemo` page from its hardcoded data model. The current implementation is tightly coupled to the `DataItem` type, making it impossible to reuse for other data. This refactor will transform it into a generic, library-style feature, inspired by the schema-driven approach of the `dynamic-view` project.

    The core idea is to introduce a `ViewConfig` object that declaratively defines the data schema, layout, and available interactions (sorting, filtering, grouping). All view components (`Card`, `List`, `Table`, etc.) will be refactored to render based on this configuration rather than hardcoded field access. This turns the `DataDemo` page into a consumer of its own generalized components.

    The primary constraint is to achieve this massive internal change with zero UI shift. The final `DataDemo` page will look and function identically to the original, serving as the canonical example of how to use this new dynamic view system.
  parts:
    - uuid: 'a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6'
      status: 'todo'
      name: 'Part 1: Establish Dynamic View Core Infrastructure'
      reason: |
        To begin, we need to create the foundational abstractions for the new dynamic view system. This involves defining the core types for configuration, data, and creating the context provider that will supply this information to all components. This replaces the hardcoded `DataItem` types with a generic, flexible structure.
      steps:
        - uuid: 'b1c2d3e4-f5g6-h7i8-j9k0-l1m2n3o4p5q6'
          status: 'todo'
          name: '1. Create New Directory and Core Types'
          reason: |
            A dedicated directory will house the new reusable feature. The `types.ts` file is the most critical part, defining the contract for how users will configure the dynamic view engine. It abstracts concepts like fields, views, and data items.
          files:
            - 'src/features/dynamic-view/types.ts'
            - 'src/pages/DataDemo/types.ts'
          operations:
            - 'Create a new directory `src/features/dynamic-view`.'
            - 'Create a new file `src/features/dynamic-view/types.ts`.'
            - 'In `dynamic-view/types.ts`, define core interfaces: `GenericItem` (a `Record<string, any>`), `FieldDefinition` (describing a data field, its type, label, and rendering hints), and `ViewConfig` (a comprehensive object defining fields, view layouts, sort/filter/group options).'
            - 'The `FieldDefinition` should support types like `string`, `badge`, `avatar`, `date`, `progress`, and `custom` to handle various rendering needs.'
            - 'The `ViewConfig` will have sections for `listView`, `cardView`, `tableView`, `kanbanView`, and `calendarView` to specify which fields appear and how.'
            - 'Update `src/pages/DataDemo/types.ts` to import and re-export types from the new file for now, to minimize initial breakages. We will phase this file out.'
        - uuid: 'c2d3e4f5-g6h7-i8j9-k0l1-m2n3o4p5q6r7'
          status: 'todo'
          name: '2. Implement Dynamic View Provider and Hook'
          reason: |
            A React Context is the cleanest way to provide the `ViewConfig` and data to the deeply nested view components without prop drilling.
          files:
            - 'src/features/dynamic-view/DynamicViewContext.tsx'
          operations:
            - 'Create a new file `src/features/dynamic-view/DynamicViewContext.tsx`.'
            - 'Implement a `DynamicViewProvider` that accepts a `viewConfig` and `data` as props and makes them available via context.'
            - 'Create a `useDynamicView` custom hook that provides easy access to the context values (`config`, `data`, etc.).'
      context_files:
        compact:
          - 'src/pages/DataDemo/types.ts'
        medium:
          - 'src/pages/DataDemo/types.ts'
          - 'src/pages/DataDemo/index.tsx'
        extended:
          - 'src/pages/DataDemo/types.ts'
          - 'src/pages/DataDemo/index.tsx'
          - 'src/lib/store.ts' # from dynamic-view project for inspiration
          - 'src/lib/types.ts' # from dynamic-view project for inspiration
    - uuid: 'd4e5f6g7-h8i9-j0k1-l2m3-n4o5p6q7r8s9'
      status: 'todo'
      name: 'Part 2: Generalize and Relocate Components'
      reason: |
        The existing `DataDemo` components need to be moved to the new `dynamic-view` feature directory to signify their reusable nature. We'll also create a central `FieldRenderer` to handle the display of different data types, replacing the specialized `DataItemParts` component.
      steps:
        - uuid: 'e5f6g7h8-i9j0-k1l2-m3n4-o5p6q7r8s9t0'
          status: 'todo'
          name: '1. Relocate and Rename View Components'
          reason: |
            Moving the components signals their promotion from feature-specific to reusable library components.
          files:
            - 'src/pages/DataDemo/components/DataListView.tsx'
            - 'src/pages/DataDemo/components/DataCardView.tsx'
            - 'src/pages/DataDemo/components/DataTableView.tsx'
            - 'src/pages/DataDemo/components/DataKanbanView.tsx'
            - 'src/pages/DataDemo/components/DataCalendarView.tsx'
            - 'src/pages/DataDemo/components/DataViewControls.tsx'
            - 'src/pages/DataDemo/components/DataViewModeSelector.tsx'
          operations:
            - 'Create new directories: `src/features/dynamic-view/components/views`, `src/features/dynamic-view/components/controls`, and `src/features/dynamic-view/components/shared`.'
            - 'Move `DataListView.tsx`, `DataCardView.tsx`, `DataTableView.tsx`, `DataKanbanView.tsx`, `DataCalendarView.tsx` to `src/features/dynamic-view/components/views/`.'
            - 'Rename them to `ListView.tsx`, `CardView.tsx`, `TableView.tsx`, `KanbanView.tsx`, `CalendarView.tsx` respectively.'
            - 'Move `DataViewControls.tsx` and `DataViewModeSelector.tsx` to `src/features/dynamic-view/components/controls/` and rename them to `ViewControls.tsx` and `ViewModeSelector.tsx`.'
        - uuid: 'f6g7h8i9-j0k1-l2m3-n4o5-p6q7r8s9t0u1'
          status: 'todo'
          name: '2. Create Generic FieldRenderer'
          reason: |
            This component centralizes the logic for rendering different field types (`badge`, `avatar`, etc.), making the view components cleaner and replacing the hardcoded `DataItemParts`.
          files:
            - 'src/features/dynamic-view/components/shared/FieldRenderer.tsx'
            - 'src/pages/DataDemo/components/shared/DataItemParts.tsx'
          operations:
            - 'Create `src/features/dynamic-view/components/shared/FieldRenderer.tsx`.'
            - 'This component will use the `useDynamicView` hook to get the `FieldDefinition` for a given field ID.'
            - 'It will contain a `switch` statement or mapping object based on `field.type` to render the appropriate component (e.g., a `Badge` for `badge` type, an `Avatar` for `avatar` type).'
            - 'It will also handle custom `render` functions defined in the `FieldDefinition`.'
            - 'The functionality from `DataItemParts.tsx` like `getStatusColor` will be moved into this component or made configurable via the `ViewConfig`.'
      context_files:
        compact:
          - 'src/pages/DataDemo/components/shared/DataItemParts.tsx'
        medium:
          - 'src/pages/DataDemo/components/DataListView.tsx'
          - 'src/pages/DataDemo/components/DataCardView.tsx'
          - 'src/pages/DataDemo/components/DataTableView.tsx'
          - 'src/pages/DataDemo/components/shared/DataItemParts.tsx'
        extended:
          - 'src/pages/DataDemo/components/DataListView.tsx'
          - 'src/pages/DataDemo/components/DataCardView.tsx'
          - 'src/pages/DataDemo/components/DataTableView.tsx'
          - 'src/pages/DataDemo/components/DataKanbanView.tsx'
          - 'src/pages/DataDemo/components/DataCalendarView.tsx'
          - 'src/pages/DataDemo/components/shared/DataItemParts.tsx'
    - uuid: 'g7h8i9j0-k1l2-m3n4-o5p6-q7r8s9t0u1v2'
      status: 'todo'
      name: 'Part 3: Refactor All Views and Controls to be Dynamic'
      reason: |
        This is the core of the refactor, where we rewire every component to be driven by the `ViewConfig` from our new context instead of a hardcoded data structure.
      steps:
        - uuid: 'h8i9j0k1-l2m3-n4o5-p6q7-r8s9t0u1v2w3'
          status: 'todo'
          name: '1. Refactor ListView and CardView'
          reason: |
            These are the simplest views and are good candidates to start with. They will prove out the `FieldRenderer` and config-driven layout.
          files:
            - 'src/features/dynamic-view/components/views/ListView.tsx'
            - 'src/features/dynamic-view/components/views/CardView.tsx'
            - 'src/features/dynamic-view/components/shared/FieldRenderer.tsx'
          operations:
            - 'In `ListView.tsx`, replace direct property access like `item.title` with the `FieldRenderer` component, e.g., `<FieldRenderer item={item} fieldId={config.listView.titleField} />`.'
            - 'Map over `config.listView.metaFields` to render the metadata on the right side.'
            - 'In `CardView.tsx`, do the same. Use the `config.cardView` layout definition (`headerFields`, `contentFields`, `footerFields`) to place `FieldRenderer` components in the correct sections of the card.'
        - uuid: 'i9j0k1l2-m3n4-o5p6-q7r8-s9t0u1v2w3x4'
          status: 'todo'
          name: '2. Refactor TableView'
          reason: |
            The table is more complex, involving dynamic column generation. This step makes the entire table structure, including headers, cell renderers, and sorting, configurable.
          files:
            - 'src/features/dynamic-view/components/views/TableView.tsx'
          operations:
            - 'In `TableView.tsx`, dynamically generate the `columns` array for the `useReactTable` hook.'
            - 'Map over `config.tableView.columns` from the `ViewConfig`.'
            - 'For each column config, create a column definition with a `header` from `col.label` and a `cell` renderer that uses our `<FieldRenderer fieldId={col.fieldId} ... />`.'
            - 'The sorting logic (`handleSortClick`) will now dispatch actions based on the generic `fieldId`.'
        - uuid: 'j0k1l2m3-n4o5-p6q7-r8s9-t0u1v2w3x4y5'
          status: 'todo'
          name: '3. Refactor KanbanView and CalendarView'
          reason: |
            These views have unique requirements (grouping by a field, using date fields) that must be made configurable.
          files:
            - 'src/features/dynamic-view/components/views/KanbanView.tsx'
            - 'src/features/dynamic-view/components/views/CalendarView.tsx'
          operations:
            - 'In `KanbanView.tsx`, the grouping logic will use `config.kanbanView.groupByField` to determine which item property to use for creating columns.'
            - 'The kanban card content will be rendered dynamically, similar to `CardView.tsx`, based on `config.kanbanView.cardFields`.'
            - 'In `CalendarView.tsx`, the component will read `config.calendarView.dateField`, `config.calendarView.titleField`, etc., to know how to map `GenericItem` objects to calendar events.'
        - uuid: 'k1l2m3n4-o5p6-q7r8-s9t0-u1v2w3x4y5z6'
          status: 'todo'
          name: '4. Refactor ViewControls'
          reason: |
            The controls for sorting, filtering, and grouping must also be populated from the `ViewConfig` instead of hardcoded lists.
          files:
            - 'src/features/dynamic-view/components/controls/ViewControls.tsx'
            - 'src/hooks/useAppViewManager.hook.ts'
          operations:
            - 'In `ViewControls.tsx` (formerly `DataViewControls`), populate the "Sort by", "Group by", and filter popovers using the definitions from `config.sortableFields`, `config.groupableFields`, and `config.filterableFields` in the `ViewConfig`.'
            - 'Update `useAppViewManager.hook.ts`. The parts related to DataDemo (like `viewMode`, `groupBy`, `sortConfig`) will be made more generic to handle URL state for any dynamic view, not just the demo.'
      context_files:
        compact:
          - 'src/features/dynamic-view/types.ts'
          - 'src/pages/DataDemo/components/DataTableView.tsx'
          - 'src/pages/DataDemo/components/DataViewControls.tsx'
        medium:
          - 'src/features/dynamic-view/types.ts'
          - 'src/features/dynamic-view/components/views/TableView.tsx'
          - 'src/features/dynamic-view/components/controls/ViewControls.tsx'
          - 'src/hooks/useAppViewManager.hook.ts'
        extended:
          - 'src/features/dynamic-view/types.ts'
          - 'src/pages/DataDemo/components/DataTableView.tsx'
          - 'src/pages/DataDemo/components/DataKanbanView.tsx'
          - 'src/pages/DataDemo/components/DataCalendarView.tsx'
          - 'src/pages/DataDemo/components/DataViewControls.tsx'
          - 'src/hooks/useAppViewManager.hook.ts'
    - uuid: 'l2m3n4o5-p6q7-r8s9-t0u1-v2w3x4y5z6a7'
      status: 'todo'
      name: 'Part 4: Reimplement DataDemo as a Consumer and Cleanup'
      reason: |
        With the generic engine built, we now circle back to the `DataDemo` page and implement it using our new system. This validates the refactor and serves as the primary usage example.
      steps:
        - uuid: 'm3n4o5p6-q7r8-s9t0-u1v2-w3x4y5z6a7b8'
          status: 'todo'
          name: '1. Create the Master ViewConfig for DataDemo'
          reason: |
            This configuration object is the "source code" for the DataDemo UI. It will translate the previously hardcoded logic into a declarative structure.
          files:
            - 'src/pages/DataDemo/DataDemo.config.ts'
            - 'src/pages/DataDemo/index.tsx'
          operations:
            - 'Create a new file `src/pages/DataDemo/DataDemo.config.ts`.'
            - 'In this file, define a comprehensive `ViewConfig` object that replicates the exact behavior of the original `DataDemo` page.'
            - 'Define all fields (`title`, `status`, `priority`, `assignee`, etc.) in the `fields` array of the config, specifying their types, labels, and rendering options (e.g., color maps for status badges).'
            - 'Fill out the `listView`, `cardView`, `tableView`, `kanbanView`, and `calendarView` sections with the appropriate field IDs to match the original layout.'
            - 'Define the `sortableFields`, `filterableFields`, and `groupableFields`.'
        - uuid: 'n4o5p6q7-r8s9-t0u1-v2w3-x4y5z6a7b8c9'
          status: 'todo'
          name: '2. Refactor DataDemo Page and Store'
          reason: |
            This step connects the new generic components to the `DataDemo.config.ts` and the mock data, completing the loop.
          files:
            - 'src/pages/DataDemo/index.tsx'
            - 'src/pages/DataDemo/store/dataDemo.store.tsx'
          operations:
            - 'In `DataDemo/index.tsx`, import the new generic components from `src/features/dynamic-view/`.'
            - 'Import the `viewConfig` from `DataDemo.config.ts`.'
            - 'Wrap the page content in the `<DynamicViewProvider config={viewConfig} data={items}>`.'
            - 'The JSX within the provider will now be much simpler, consisting of `<ViewControls />` and a component that renders the currently active view.'
            - 'Update `dataDemo.store.tsx` to handle `GenericItem[]` instead of `DataItem[]`. The logic for filtering/sorting/grouping should become more generic, taking a field key as an argument.'
        - uuid: 'o5p6q7r8-s9t0-u1v2-w3x4-y5z6a7b8c9d0'
          status: 'todo'
          name: '3. Final Cleanup'
          reason: |
            Remove all the old, now-redundant files and code to finalize the refactor.
          files:
            - 'src/pages/DataDemo/components/'
            - 'src/pages/DataDemo/types.ts'
          operations:
            - 'Delete the entire `src/pages/DataDemo/components` directory, as all its contents have been moved, generalized, or replaced.'
            - 'Delete `src/pages/DataDemo/types.ts` as its role has been superseded by `src/features/dynamic-view/types.ts`.'
            - 'Search for and remove any remaining dead code or imports related to the old structure.'
      context_files:
        compact:
          - 'src/pages/DataDemo/index.tsx'
          - 'src/pages/DataDemo/store/dataDemo.store.tsx'
        medium:
          - 'src/pages/DataDemo/index.tsx'
          - 'src/pages/DataDemo/store/dataDemo.store.tsx'
          - 'src/features/dynamic-view/types.ts'
        extended:
          - 'src/pages/DataDemo/index.tsx'
          - 'src/pages/DataDemo/store/dataDemo.store.tsx'
          - 'src/features/dynamic-view/types.ts'
          - 'src/features/dynamic-view/DynamicViewContext.tsx'
  conclusion: |
    Upon completion, the `DataDemo` feature will be transformed from a monolithic, single-purpose page into a powerful and reusable `dynamic-view` engine. Developers using this app shell as a library can now easily create complex, data-rich views for their own models by simply providing a configuration object.

    This refactor significantly increases the value of the app shell, promoting code reuse, consistency, and faster development for data-centric features. We've paid our technical debt and invested in a scalable abstraction that will pay dividends on future projects, all while maintaining a stable and polished user interface.
  context_files:
    compact:
      - 'src/pages/DataDemo/index.tsx'
      - 'src/pages/DataDemo/types.ts'
      - 'src/features/dynamic-view/types.ts'
    medium:
      - 'src/pages/DataDemo/index.tsx'
      - 'src/pages/DataDemo/types.ts'
      - 'src/features/dynamic-view/types.ts'
      - 'src/pages/DataDemo/components/DataTableView.tsx'
      - 'src/pages/DataDemo/components/DataCardView.tsx'
      - 'src/lib/types.ts' # from dynamic-view project
    extended:
      - 'src/pages/DataDemo/index.tsx'
      - 'src/pages/DataDemo/types.ts'
      - 'src/features/dynamic-view/types.ts'
      - 'src/pages/DataDemo/components/DataTableView.tsx'
      - 'src/pages/DataDemo/components/DataCardView.tsx'
      - 'src/pages/DataDemo/components/DataViewControls.tsx'
      - 'src/hooks/useAppViewManager.hook.ts'
      - 'src/lib/types.ts' # from dynamic-view project
      - 'src/lib/store.ts' # from dynamic-view project
      - 'src/pages/ItemCrudPage.tsx' # from dynamic-view project
```
