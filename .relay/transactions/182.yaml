uuid: 48df994a-e490-4c17-8e10-c081e62ddc6a
projectId: jeli-app-shell
createdAt: '2025-10-13T01:48:45.785Z'
gitCommitMsg: >-
  refactor(DataDemo): Enhance UI cohesion and minimalism

  - Refactored `DataToolbar` to combine Status and Priority filters into a
  single "Filters" popover, reducing clutter and preventing horizontal overflow.
  - Updated the active filter count to show the total number of applied filters
  for better clarity. - Reorganized the `DataDemoPage` layout for a more logical
  flow: Header -> Stats -> Toolbar -> Data. - Moved `DataViewModeSelector` into
  the main page header for better visibility and separation of concerns.
promptSummary: >-
  I want to make the UI layout and UX of the demo data page more cohesive and
  minimalist, while keeping the `DataViewModeSelector`'s cool UI and avoiding
  horizontal overflow.
reasoning:
  - >-
    This is an excellent request! Achieving a minimalist and cohesive UI often
    involves simplifying controls and refining the layout hierarchy. Here's my
    plan to improve the data demo page:
  - >-
    1.  **Simplify the Toolbar:** I'll combine the "Status" and "Priority"
    filters into a single "Filters" button. This button will open a popover
    containing both filter options, significantly cleaning up the toolbar and
    preventing overflow on smaller screens. I will also make the filter count
    more intuitive by showing the total number of selected options.
  - >-
    2.  **Refine Page Layout:** I'll adjust the page structure for a more
    logical flow. The `DataViewModeSelector`, which you like, will be elevated
    to the main page header, giving it prominence. The stats cards will be
    positioned above the toolbar, providing a high-level summary before users
    dive into filtering and sorting the data below.
  - >-
    3.  **Enhance Minimalism:** By consolidating the filters, the separate
    "Reset" button becomes redundant. I will remove it from the main toolbar;
    users can clear filters from within the new filter popover, which is a
    cleaner and more common UX pattern.
  - >-
    These changes will result in a less cluttered, more intuitive interface that
    feels cohesive and modern, all while preserving the cool functionality of
    the view mode selector.
  - 'Here are the code modifications:'
  - '### Step 1: Refactor `DataToolbar` to be more minimalist'
  - >-
    I'll modify `DataToolbar.tsx` to combine the filters into a single popover,
    remove the now-redundant `viewMode` props, and remove the external reset
    button. This makes the component much cleaner and focused.
  - '### Step 2: Update the main page layout'
  - >-
    Now I'll update `DataDemoPage/index.tsx` to move the `DataViewModeSelector`
    to the header and re-order the page sections for a better visual hierarchy.
  - >-
    I've left the "Reset" button in the toolbar for quick access, as removing it
    might be a step too far in minimalism for some users, but I've simplified
    its appearance by removing the icon to blend better with the new design.
  - 'YAML:'
operations:
  - type: write
    path: src/pages/DataDemo/components/DataToolbar.tsx
    content: >
      --- src/pages/DataDemo/components/DataToolbar.tsx

      +++ src/pages/DataDemo/components/DataToolbar.tsx

      @@ -1,5 +1,5 @@
       import * as React from 'react'
      -import { Check, ListFilter, Search, SortAsc, X } from 'lucide-react'

      +import { Check, ListFilter, Search, SortAsc } from 'lucide-react'
       
       import { cn } from '@/lib/utils'
       import { Button } from '@/components/ui/button'
      @@ -18,20 +18,17 @@
         CommandSeparator,
       } from '@/components/ui/command'
       
      -import { DataViewModeSelector } from './DataViewModeSelector'

      -import type { ViewMode, SortConfig, SortableField, Status, Priority }
      from '../types'

      +import type { SortConfig, SortableField, Status, Priority } from
      '../types'
       
       export interface FilterConfig {
         searchTerm: string
         status: Status[]
         priority: Priority[]
       }
       
       interface DataToolbarProps {
      -  viewMode: ViewMode

      -  onViewModeChange: (mode: ViewMode) => void
         filters: FilterConfig
         onFiltersChange: (filters: FilterConfig) => void
         sortConfig: SortConfig | null
         onSortChange: (config: SortConfig | null) => void
       }
      @@ -58,8 +55,6 @@
       
       
       export function DataToolbar({
      -  viewMode,

      -  onViewModeChange,
         filters,
         onFiltersChange,
         sortConfig,
      @@ -69,14 +64,11 @@
           onFiltersChange({ ...filters, searchTerm: event.target.value })
         }
         
      -  const activeFilterCount =

      -    (filters.status.length > 0 ? 1 : 0) +

      -    (filters.priority.length > 0 ? 1 : 0)

      +  const activeFilterCount = filters.status.length +
      filters.priority.length
       
         return (
      -    <div className="flex flex-col md:flex-row items-center
      justify-between gap-4">

      -      {/* Left side: Search and Filters */}

      +    <div className="flex flex-col md:flex-row items-center
      justify-between gap-4 w-full">

      +      {/* Left side: Search, Filters */}
             <div className="flex flex-col sm:flex-row items-center gap-2 w-full md:w-auto">
               <div className="relative w-full sm:w-auto">
                 <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
      @@ -88,38 +80,31 @@
                 />
               </div>
       
      -        {/* Status Filter */}

      -        <MultiSelectFilter

      -          title="Status"

      -          options={statusOptions}

      -          selected={filters.status}

      -          onChange={(selected) => onFiltersChange({ ...filters, status:
      selected as Status[] })}

      -        />

      -

      -        {/* Priority Filter */}

      -        <MultiSelectFilter

      -          title="Priority"

      -          options={priorityOptions}

      -          selected={filters.priority}

      -          onChange={(selected) => onFiltersChange({ ...filters, priority:
      selected as Priority[] })}

      -        />

      +        <Popover>

      +          <PopoverTrigger asChild>

      +            <Button variant="outline" size="sm" className="h-9 w-full
      sm:w-auto justify-start border-dashed">

      +              <ListFilter className="mr-2 h-4 w-4" />

      +              Filters

      +              {activeFilterCount > 0 && (

      +                <>

      +                  <div className="mx-2 h-4 w-px bg-muted-foreground/50"
      />

      +                  <Badge variant="secondary" className="rounded-sm px-1
      font-normal">

      +                    {activeFilterCount}

      +                  </Badge>

      +                </>

      +              )}

      +            </Button>

      +          </PopoverTrigger>

      +          <PopoverContent className="w-[240px] p-0" align="start">

      +            <CombinedFilter filters={filters}
      onFiltersChange={onFiltersChange} />

      +          </PopoverContent>

      +        </Popover>
       
               {activeFilterCount > 0 && (
      -          <Button

      -            variant="ghost"

      -            onClick={() => onFiltersChange({ searchTerm:
      filters.searchTerm, status: [], priority: [] })}

      -            className="h-9 px-2 lg:px-3"

      -          >

      -            Reset

      -            <X className="ml-2 h-4 w-4" />

      -          </Button>

      +          <Button variant="ghost" onClick={() => onFiltersChange({
      searchTerm: filters.searchTerm, status: [], priority: []
      })}>Reset</Button>
               )}
             </div>
       
      -      {/* Right side: Sorter and View Mode */}

      -      <div className="flex items-center gap-2 w-full md:w-auto
      justify-end">

      +      {/* Right side: Sorter */}

      +      <div className="flex items-center gap-2 w-full md:w-auto
      justify-start md:justify-end">
               <DropdownMenu>
                 <DropdownMenuTrigger asChild>
                   <Button variant="outline" className="w-full sm:w-auto justify-start">
      @@ -148,88 +133,96 @@
                   </DropdownMenuRadioGroup>
                 </DropdownMenuContent>
               </DropdownMenu>
      -

      -        <DataViewModeSelector viewMode={viewMode}
      onChange={onViewModeChange} />
             </div>
           </div>
         )
       }
       
      -function MultiSelectFilter({

      -  title,

      -  options,

      -  selected,

      -  onChange,

      +function CombinedFilter({

      +  filters,

      +  onFiltersChange,
       }: {
      -  title: string

      -  options: { value: string; label: string }[]

      -  selected: string[]

      -  onChange: (selected: string[]) => void

      +  filters: FilterConfig;

      +  onFiltersChange: (filters: FilterConfig) => void;
       }) {
      -  const selectedSet = new Set(selected)

      +  const selectedStatus = new Set(filters.status);

      +  const selectedPriority = new Set(filters.priority);

      +

      +  const handleStatusSelect = (status: Status) => {

      +    selectedStatus.has(status) ? selectedStatus.delete(status) :
      selectedStatus.add(status);

      +    onFiltersChange({ ...filters, status: Array.from(selectedStatus) });

      +  };

      +

      +  const handlePrioritySelect = (priority: Priority) => {

      +    selectedPriority.has(priority) ? selectedPriority.delete(priority) :
      selectedPriority.add(priority);

      +    onFiltersChange({ ...filters, priority: Array.from(selectedPriority)
      });

      +  };

      +

      +  const hasActiveFilters = filters.status.length > 0 ||
      filters.priority.length > 0;
       
         return (
      -    <Popover>

      -      <PopoverTrigger asChild>

      -        <Button variant="outline" size="sm" className="h-9 w-full
      sm:w-auto justify-start border-dashed">

      -          <ListFilter className="mr-2 h-4 w-4" />

      -          {title}

      -          {selected.length > 0 && (

      -            <>

      -              <div className="mx-2 h-4 w-px bg-muted-foreground/50" />

      -              <Badge variant="secondary" className="rounded-sm px-1
      font-normal">

      -                {selected.length}

      -              </Badge>

      -            </>

      -          )}

      -        </Button>

      -      </PopoverTrigger>

      -      <PopoverContent className="w-[220px] p-0" align="start">

      -        <Command>

      -          <CommandInput placeholder={`Filter ${title.toLowerCase()}...`}
      />

      -          <CommandList>

      -            <CommandEmpty>No results found.</CommandEmpty>

      +    <Command>

      +      <CommandInput placeholder="Filter by..." />

      +      <CommandList>

      +        <CommandEmpty>No results found.</CommandEmpty>

      +

      +        <CommandGroup heading="Status">

      +          {statusOptions.map((option) => {

      +            const isSelected = selectedStatus.has(option.value);

      +            return (

      +              <CommandItem

      +                key={option.value}

      +                onSelect={() => handleStatusSelect(option.value)}

      +              >

      +                <div

      +                  className={cn(

      +                    'mr-2 flex h-4 w-4 items-center justify-center
      rounded-sm border border-primary',

      +                    isSelected ? 'bg-primary text-primary-foreground' :
      'opacity-50 [&_svg]:invisible'

      +                  )}

      +                >

      +                  <Check className={cn('h-4 w-4')} />

      +                </div>

      +                <span>{option.label}</span>

      +              </CommandItem>

      +            );

      +          })}

      +        </CommandGroup>

      +

      +        <CommandSeparator />

      +

      +        <CommandGroup heading="Priority">

      +          {priorityOptions.map((option) => {

      +            const isSelected = selectedPriority.has(option.value);

      +            return (

      +              <CommandItem

      +                key={option.value}

      +                onSelect={() => handlePrioritySelect(option.value)}

      +              >

      +                <div

      +                  className={cn(

      +                    'mr-2 flex h-4 w-4 items-center justify-center
      rounded-sm border border-primary',

      +                    isSelected ? 'bg-primary text-primary-foreground' :
      'opacity-50 [&_svg]:invisible'

      +                  )}

      +                >

      +                  <Check className={cn('h-4 w-4')} />

      +                </div>

      +                <span>{option.label}</span>

      +              </CommandItem>

      +            );

      +          })}

      +        </CommandGroup>

      +

      +        {hasActiveFilters && (

      +          <>

      +            <CommandSeparator />
                   <CommandGroup>
      -              {options.map((option) => {

      -                const isSelected = selectedSet.has(option.value)

      -                return (

      -                  <CommandItem

      -                    key={option.value}

      -                    onSelect={() => {

      -                      if (isSelected) {

      -                        selectedSet.delete(option.value)

      -                      } else {

      -                        selectedSet.add(option.value)

      -                      }

      -                      onChange(Array.from(selectedSet))

      -                    }}

      -                  >

      -                    <div

      -                      className={cn(

      -                        'mr-2 flex h-4 w-4 items-center justify-center
      rounded-sm border border-primary',

      -                        isSelected ? 'bg-primary text-primary-foreground'
      : 'opacity-50 [&_svg]:invisible'

      -                      )}

      -                    >

      -                      <Check className={cn('h-4 w-4')} />

      -                    </div>

      -                    <span>{option.label}</span>

      -                  </CommandItem>

      -                )

      -              })}

      +              <CommandItem

      +                onSelect={() => onFiltersChange({ ...filters, status: [],
      priority: [] })}

      +                className="justify-center text-center text-sm"

      +              >

      +                Clear filters

      +              </CommandItem>
                   </CommandGroup>
      -            {selected.length > 0 && (

      -              <>

      -                <CommandSeparator />

      -                <CommandGroup>

      -                  <CommandItem

      -                    onSelect={() => onChange([])}

      -                    className="justify-center text-center"

      -                  >

      -                    Clear filters

      -                  </CommandItem>

      -                </CommandGroup>

      -              </>

      -            )}

      -          </CommandList>

      -        </Command>

      -      </PopoverContent>

      -    </Popover>

      +          </>

      +        )}

      +      </CommandList>

      +    </Command>
         )
       }
    patchStrategy: standard-diff
  - type: write
    path: src/pages/DataDemo/index.tsx
    content: >
      --- src/pages/DataDemo/index.tsx

      +++ src/pages/DataDemo/index.tsx

      @@ -9,6 +9,7 @@
       import { DataListView } from './components/DataListView'
       import { DataCardView } from './components/DataCardView'
       import { DataTableView } from './components/DataTableView'
      +import { DataViewModeSelector } from './components/DataViewModeSelector'
       import { DataDetailPanel } from './components/DataDetailPanel'
       import { AnimatedLoadingSkeleton } from './components/AnimatedLoadingSkeleton'
       import { StatChartCard } from './components/StatChartCard'
      @@ -201,38 +202,40 @@
           >
             <div className="space-y-8">
               {/* Header */}
               <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      -          <div>

      +          <div className="flex-1">
                   <h1 className="text-2xl font-bold tracking-tight">Data Showcase</h1>
                   <p className="text-muted-foreground">
                     {isInitialLoading 
                       ? "Loading projects..." 
                       : `Showing ${processedData.length} item(s)`}
                   </p>
                 </div>
      -        </div>

      -        <div className="flex flex-col md:flex-row md:items-center
      md:justify-between gap-4">

      -          <DataToolbar 

      -            viewMode={viewMode} onViewModeChange={setViewMode}

      -            filters={filters} onFiltersChange={handleFilterChange}

      -            sortConfig={sortConfig} onSortChange={handleSortChange} />

      +          <DataViewModeSelector viewMode={viewMode}
      onChange={setViewMode} />
               </div>
       
               {/* Stats Section */}
               {!isInitialLoading && (
                 <div ref={statsRef} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      -            {stats.map((stat) => {

      -              if (stat.type === 'chart') {

      -                return (

      -                  <StatChartCard

      -                    key={stat.title}

      -                    title={stat.title}

      -                    value={stat.value}

      -                    change={stat.change}

      -                    trend={stat.trend}

      -                    icon={stat.icon}

      -                    chartData={stat.chartData}

      -                  />

      -                )

      -              }

      -            })}

      +            {stats.map((stat) =>

      +              stat.type === 'chart' ? (

      +                <StatChartCard

      +                  key={stat.title}

      +                  title={stat.title}

      +                  value={stat.value}

      +                  change={stat.change}

      +                  trend={stat.trend}

      +                  icon={stat.icon}

      +                  chartData={stat.chartData}

      +                />

      +              ) : null

      +            )}
                 </div>
               )}
       
      +        <DataToolbar

      +          filters={filters}

      +          onFiltersChange={handleFilterChange}

      +          sortConfig={sortConfig}

      +          onSortChange={handleSortChange}

      +        />

      +
               <div ref={contentRef} className="min-h-[500px]">
                 {isInitialLoading ? <AnimatedLoadingSkeleton viewMode={viewMode} /> : renderView()}
               </div>
    patchStrategy: standard-diff
snapshot:
  src/pages/DataDemo/components/DataToolbar.tsx: >-
    import * as React from 'react'

    import { Check, ListFilter, Search, SortAsc, X } from 'lucide-react'


    import { cn } from '@/lib/utils'

    import { Button } from '@/components/ui/button'

    import { Input } from '@/components/ui/input'

    import { Badge } from '@/components/ui/badge'

    import { Popover, PopoverContent, PopoverTrigger } from
    '@/components/ui/popover'

    import {
      DropdownMenu,
      DropdownMenuContent,
      DropdownMenuRadioGroup,
      DropdownMenuRadioItem,
      DropdownMenuSeparator,
      DropdownMenuLabel,
      DropdownMenuTrigger,
    } from '@/components/ui/dropdown-menu'

    import {
      Command,
      CommandEmpty,
      CommandGroup,
      CommandInput,
      CommandItem,
      CommandList,
      CommandSeparator,
    } from '@/components/ui/command'


    import { DataViewModeSelector } from './DataViewModeSelector'

    import type { ViewMode, SortConfig, SortableField, Status, Priority } from
    '../types'


    export interface FilterConfig {
      searchTerm: string
      status: Status[]
      priority: Priority[]
    }


    interface DataToolbarProps {
      viewMode: ViewMode
      onViewModeChange: (mode: ViewMode) => void
      filters: FilterConfig
      onFiltersChange: (filters: FilterConfig) => void
      sortConfig: SortConfig | null
      onSortChange: (config: SortConfig | null) => void
    }


    const statusOptions: { value: Status; label: string }[] = [
      { value: 'active', label: 'Active' },
      { value: 'pending', label: 'Pending' },
      { value: 'completed', label: 'Completed' },
      { value: 'archived', label: 'Archived' },
    ]


    const priorityOptions: { value: Priority; label: string }[] = [
      { value: 'critical', label: 'Critical' },
      { value: 'high', label: 'High' },
      { value: 'medium', label: 'Medium' },
      { value: 'low', label: 'Low' },
    ]


    const sortOptions: { value: SortableField, label: string }[] = [
      { value: 'updatedAt', label: 'Last Updated' },
      { value: 'title', label: 'Title' },
      { value: 'status', label: 'Status' },
      { value: 'priority', label: 'Priority' },
      { value: 'metrics.completion', label: 'Progress' },
    ]



    export function DataToolbar({
      viewMode,
      onViewModeChange,
      filters,
      onFiltersChange,
      sortConfig,
      onSortChange,
    }: DataToolbarProps) {
      const handleSearchChange = (event: React.ChangeEvent<HTMLInputElement>) => {
        onFiltersChange({ ...filters, searchTerm: event.target.value })
      }
      
      const activeFilterCount =
        (filters.status.length > 0 ? 1 : 0) +
        (filters.priority.length > 0 ? 1 : 0)

      return (
        <div className="flex flex-col md:flex-row items-center justify-between gap-4">
          {/* Left side: Search and Filters */}
          <div className="flex flex-col sm:flex-row items-center gap-2 w-full md:w-auto">
            <div className="relative w-full sm:w-auto">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
              <Input
                placeholder="Search projects..."
                className="pl-9 w-full sm:w-64"
                value={filters.searchTerm}
                onChange={handleSearchChange}
              />
            </div>

            {/* Status Filter */}
            <MultiSelectFilter
              title="Status"
              options={statusOptions}
              selected={filters.status}
              onChange={(selected) => onFiltersChange({ ...filters, status: selected as Status[] })}
            />

            {/* Priority Filter */}
            <MultiSelectFilter
              title="Priority"
              options={priorityOptions}
              selected={filters.priority}
              onChange={(selected) => onFiltersChange({ ...filters, priority: selected as Priority[] })}
            />

            {activeFilterCount > 0 && (
              <Button
                variant="ghost"
                onClick={() => onFiltersChange({ searchTerm: filters.searchTerm, status: [], priority: [] })}
                className="h-9 px-2 lg:px-3"
              >
                Reset
                <X className="ml-2 h-4 w-4" />
              </Button>
            )}
          </div>

          {/* Right side: Sorter and View Mode */}
          <div className="flex items-center gap-2 w-full md:w-auto justify-end">
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button variant="outline" className="w-full sm:w-auto justify-start">
                  <SortAsc className="mr-2 h-4 w-4" />
                  Sort by: {sortOptions.find(o => o.value === sortConfig?.key)?.label || 'Default'}
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end" className="w-[200px]">
                <DropdownMenuLabel>Sort by</DropdownMenuLabel>
                <DropdownMenuRadioGroup
                  value={`${sortConfig?.key || 'default'}-${sortConfig?.direction || ''}`}
                  onValueChange={(value) => {
                    if (value.startsWith('default')) {
                      onSortChange(null)
                    } else {
                      const [key, direction] = value.split('-')
                      onSortChange({ key: key as SortableField, direction: direction as 'asc' | 'desc' })
                    }
                  }}
                >
                  <DropdownMenuRadioItem value="default-">Default</DropdownMenuRadioItem>
                  <DropdownMenuSeparator />
                  {sortOptions.map(option => (
                    <React.Fragment key={option.value}>
                      <DropdownMenuRadioItem value={`${option.value}-desc`}>{option.label} (Desc)</DropdownMenuRadioItem>
                      <DropdownMenuRadioItem value={`${option.value}-asc`}>{option.label} (Asc)</DropdownMenuRadioItem>
                    </React.Fragment>
                  ))}
                </DropdownMenuRadioGroup>
              </DropdownMenuContent>
            </DropdownMenu>

            <DataViewModeSelector viewMode={viewMode} onChange={onViewModeChange} />
          </div>
        </div>
      )
    }


    function MultiSelectFilter({
      title,
      options,
      selected,
      onChange,
    }: {
      title: string
      options: { value: string; label: string }[]
      selected: string[]
      onChange: (selected: string[]) => void
    }) {
      const selectedSet = new Set(selected)

      return (
        <Popover>
          <PopoverTrigger asChild>
            <Button variant="outline" size="sm" className="h-9 w-full sm:w-auto justify-start border-dashed">
              <ListFilter className="mr-2 h-4 w-4" />
              {title}
              {selected.length > 0 && (
                <>
                  <div className="mx-2 h-4 w-px bg-muted-foreground/50" />
                  <Badge variant="secondary" className="rounded-sm px-1 font-normal">
                    {selected.length}
                  </Badge>
                </>
              )}
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-[220px] p-0" align="start">
            <Command>
              <CommandInput placeholder={`Filter ${title.toLowerCase()}...`} />
              <CommandList>
                <CommandEmpty>No results found.</CommandEmpty>
                <CommandGroup>
                  {options.map((option) => {
                    const isSelected = selectedSet.has(option.value)
                    return (
                      <CommandItem
                        key={option.value}
                        onSelect={() => {
                          if (isSelected) {
                            selectedSet.delete(option.value)
                          } else {
                            selectedSet.add(option.value)
                          }
                          onChange(Array.from(selectedSet))
                        }}
                      >
                        <div
                          className={cn(
                            'mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary',
                            isSelected ? 'bg-primary text-primary-foreground' : 'opacity-50 [&_svg]:invisible'
                          )}
                        >
                          <Check className={cn('h-4 w-4')} />
                        </div>
                        <span>{option.label}</span>
                      </CommandItem>
                    )
                  })}
                </CommandGroup>
                {selected.length > 0 && (
                  <>
                    <CommandSeparator />
                    <CommandGroup>
                      <CommandItem
                        onSelect={() => onChange([])}
                        className="justify-center text-center"
                      >
                        Clear filters
                      </CommandItem>
                    </CommandGroup>
                  </>
                )}
              </CommandList>
            </Command>
          </PopoverContent>
        </Popover>
      )
    }
  src/pages/DataDemo/index.tsx: >-
    import { useState, useRef, useEffect, useCallback, useMemo } from 'react'

    import { 
      Layers, 
      AlertTriangle, 
      PlayCircle, 
      TrendingUp,
      Loader2
    } from 'lucide-react'

    import { gsap } from 'gsap'

    import { PageLayout } from '@/components/shared/PageLayout'

    import { DataListView } from './components/DataListView'

    import { DataCardView } from './components/DataCardView'

    import { DataTableView } from './components/DataTableView'

    import { DataDetailPanel } from './components/DataDetailPanel'

    import { AnimatedLoadingSkeleton } from
    './components/AnimatedLoadingSkeleton'

    import { StatChartCard } from './components/StatChartCard'

    import { DataToolbar, FilterConfig } from './components/DataToolbar'

    import { useAppShell } from '@/context/AppShellContext'

    import { mockDataItems } from './data/mockData'

    import type { DataItem, ViewMode, SortConfig, SortableField } from './types'


    type Stat = {
      title: string;
      value: string;
      icon: React.ReactNode;
      change: string;
      trend: 'up' | 'down';
      type?: 'card';
    };


    type ChartStat = {
      title: string;
      value: string;
      icon: React.ReactNode;
      change: string;
      trend: 'up' | 'down';
      type: 'chart';
      chartData: number[];
    };


    type StatItem = Stat | ChartStat;


    export default function DataDemoPage() {
      const [viewMode, setViewMode] = useState<ViewMode>('list')
      const [filters, setFilters] = useState<FilterConfig>({
        searchTerm: '',
        status: [],
        priority: [],
      })
      const [sortConfig, setSortConfig] = useState<SortConfig | null>({ key: 'updatedAt', direction: 'desc' })
      const [selectedItem, setSelectedItem] = useState<DataItem | null>(null)  
      const [items, setItems] = useState<DataItem[]>([])
      const [page, setPage] = useState(0) // Start at 0 to trigger initial load effect
      const [hasMore, setHasMore] = useState(true)
      const [isLoading, setIsLoading] = useState(true)
      const contentRef = useRef<HTMLDivElement>(null)
      const statsRef = useRef<HTMLDivElement>(null)
      const observer = useRef<IntersectionObserver>()
      const { openSidePane } = useAppShell()

      const isInitialLoading = isLoading && items.length === 0

      // Centralized data processing
      const processedData = useMemo(() => {
        let filteredItems = mockDataItems.filter(item => {
          const searchTermMatch =
            item.title.toLowerCase().includes(filters.searchTerm.toLowerCase()) ||
            item.description.toLowerCase().includes(filters.searchTerm.toLowerCase())

          const statusMatch = filters.status.length === 0 || filters.status.includes(item.status)
          const priorityMatch = filters.priority.length === 0 || filters.priority.includes(item.priority)

          return searchTermMatch && statusMatch && priorityMatch
        })

        if (sortConfig) {
          filteredItems.sort((a, b) => {
            let aValue: any
            let bValue: any

            const getNestedValue = (obj: any, path: string) => path.split('.').reduce((o, k) => (o || {})[k], obj)

            aValue = getNestedValue(a, sortConfig.key)
            bValue = getNestedValue(b, sortConfig.key)

            if (aValue === undefined || bValue === undefined) return 0;

            if (typeof aValue === 'string' && typeof bValue === 'string') {
              return sortConfig.direction === 'asc'
                ? aValue.localeCompare(bValue)
                : bValue.localeCompare(aValue)
            }
            if (typeof aValue === 'number' && typeof bValue === 'number') {
              return sortConfig.direction === 'asc' ? aValue - bValue : bValue - aValue
            }
            // Date sorting (assuming ISO strings)
            if (sortConfig.key === 'updatedAt' || sortConfig.key === 'createdAt') {
                return sortConfig.direction === 'asc'
                    ? new Date(aValue).getTime() - new Date(aValue).getTime()
                    : new Date(bValue).getTime() - new Date(bValue).getTime()
            }
            return 0
          })
        }
        return filteredItems
      }, [filters, sortConfig])

      // Calculate stats from data
      const totalItems = mockDataItems.length
      const activeItems = mockDataItems.filter(item => item.status === 'active').length
      const highPriorityItems = mockDataItems.filter(item => item.priority === 'high' || item.priority === 'critical').length
      const avgCompletion = totalItems > 0 ? Math.round(
        mockDataItems.reduce((acc, item) => acc + item.metrics.completion, 0) / totalItems
      ) : 0

      // Reset pagination when filters or sort change
      useEffect(() => {
        setItems([])
        setPage(0) // This will be incremented to 1 in the loader `useEffect`, triggering a fresh load
        setHasMore(true)
        // This timeout helps prevent a flicker between old and new filtered data
        setTimeout(() => setPage(1), 50)
      }, [processedData])

      // Infinite scroll logic
      useEffect(() => { // eslint-disable-line react-hooks/exhaustive-deps
        if (page === 0) return;

        const fetchItems = () => {
          setIsLoading(true);
          const isFirstPage = page === 1
          
          const pageSize = 12;
          const newItems = processedData.slice((page - 1) * pageSize, page * pageSize);
          
          // Simulate network delay, longer for initial load to showcase skeleton
          setTimeout(() => {
            setItems(prev => (isFirstPage ? newItems : [...prev, ...newItems]))
            setHasMore(processedData.length > page * pageSize)
            setIsLoading(false)
          }, isFirstPage && items.length === 0 ? 1500 : 500)
        };

        if (hasMore) fetchItems();
      }, [page]);

      const loaderRef = useCallback(node => {
        if (isLoading) return;
        if (observer.current) observer.current.disconnect();
        
        observer.current = new IntersectionObserver(entries => {
          if (entries[0].isIntersecting && hasMore) {
            setPage(prevPage => prevPage + 1);
          }
        });
        if (node) observer.current.observe(node);
      }, [isLoading, hasMore]);

      const stats: StatItem[] = [
        {
          title: "Total Projects",
          value: totalItems.toString(),
          icon: <Layers className="w-5 h-5" />,
          change: "+5.2% this month",
          trend: "up" as const,
          type: 'chart',
          chartData: [120, 125, 122, 130, 135, 138, 142]
        },
        {
          title: "Active Projects",
          value: activeItems.toString(),
          icon: <PlayCircle className="w-5 h-5" />,
          change: "+2 this week", 
          trend: "up" as const,
          type: 'chart',
          chartData: [45, 50, 48, 55, 53, 60, 58]
        },
        {
          title: "High Priority",
          value: highPriorityItems.toString(),
          icon: <AlertTriangle className="w-5 h-5" />,
          change: "-1 from last week",
          trend: "down" as const,
          type: 'chart',
          chartData: [25, 26, 28, 27, 26, 24, 23]
        },
        {
          title: "Avg. Completion",
          value: `${avgCompletion}%`,
          icon: <TrendingUp className="w-5 h-5" />,
          change: "+3.2%",
          trend: "up" as const,
          type: 'chart',
          chartData: [65, 68, 70, 69, 72, 75, 78]
        }
      ]

      useEffect(() => {
        // Animate stats cards in
        if (!isInitialLoading && statsRef.current) {
          gsap.fromTo(statsRef.current.children,
            { y: 30, opacity: 0 },
            {
              duration: 0.6,
              y: 0,
              opacity: 1,
              stagger: 0.1,
              ease: "power2.out"
            }
          )
        }
      }, [isInitialLoading])

      const handleSortChange = (config: SortConfig | null) => {
        setSortConfig(config)
      }

      // For table view header clicks
      const handleTableSort = (field: SortableField) => {
        if (sortConfig?.key === field) {
          if (sortConfig.direction === 'desc') {
            // Cycle: desc -> asc
            setSortConfig({ key: field, direction: 'asc' })
          } else {
            // Cycle: asc -> default
            setSortConfig(null)
          }
        } else {
          // New field, default to desc
          setSortConfig({ key: field, direction: 'desc' })
        }
      }

      const handleFilterChange = (newFilters: FilterConfig) => {
        setFilters(newFilters)
      }
      
      // Handle item selection and open side panel
      const handleItemSelect = (item: DataItem) => {
        setSelectedItem(item)
        openSidePane('data-details')
      }

      const renderView = () => {
        const commonProps = {
          data: items,
          onItemSelect: handleItemSelect,
          selectedItem,
          sortConfig,
          onSort: handleTableSort,
        }

        switch (viewMode) {
          case 'list':
            return <DataListView {...commonProps} />
          case 'cards':
            return <DataCardView {...commonProps} />
          case 'grid':
            return <DataCardView {...commonProps} isGrid />
          case 'table':
            return <DataTableView {...commonProps} />
          default:
            return <DataListView {...commonProps} />
        }
      }

      return (
        <PageLayout
          // Note: Search functionality is handled by a separate SearchBar in the TopBar
        >
          <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div>
                <h1 className="text-2xl font-bold tracking-tight">Data Showcase</h1>
                <p className="text-muted-foreground">
                  {isInitialLoading 
                    ? "Loading projects..." 
                    : `Showing ${processedData.length} item(s)`}
                </p>
              </div>
            </div>
            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <DataToolbar 
                viewMode={viewMode} onViewModeChange={setViewMode}
                filters={filters} onFiltersChange={handleFilterChange}
                sortConfig={sortConfig} onSortChange={handleSortChange} />
            </div>

            {/* Stats Section */}
            {!isInitialLoading && (
              <div ref={statsRef} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {stats.map((stat) => {
                  if (stat.type === 'chart') {
                    return (
                      <StatChartCard
                        key={stat.title}
                        title={stat.title}
                        value={stat.value}
                        change={stat.change}
                        trend={stat.trend}
                        icon={stat.icon}
                        chartData={stat.chartData}
                      />
                    )
                  }
                })}
              </div>
            )}

            <div ref={contentRef} className="min-h-[500px]">
              {isInitialLoading ? <AnimatedLoadingSkeleton viewMode={viewMode} /> : renderView()}
            </div>

            {/* Loader for infinite scroll */}
            <div ref={loaderRef} className="flex justify-center items-center py-6">
              {isLoading && !isInitialLoading && (
                <div className="flex items-center gap-2 text-muted-foreground">
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>Loading more...</span>
                </div>
              )}
              {!isLoading && !hasMore && processedData.length > 0 && !isInitialLoading && (
                <p className="text-muted-foreground">You've reached the end.</p>
              )}
            </div>
          </div>

          {/* Detail Panel */}
          <DataDetailPanel 
            item={selectedItem}
            onClose={() => setSelectedItem(null)}
          />
        </PageLayout>
      )
    }
approved: true
linesAdded: null
linesRemoved: null
linesDifference: null
gitCommittedAt: '2025-10-13T01:49:58.232Z'
status: committed
id: 182
